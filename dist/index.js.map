{"version":3,"file":"index.js","sources":["../src/event-dispatcher.js","../src/browserbase.js"],"sourcesContent":["const slice = Array.prototype.slice;\n\n/**\n * Simple event dispatcher\n */\nexport default class EventDispatcher {\n\n  constructor() {\n    // Define a non-enumerable \"private\" property to hold all event listeners\n    Object.defineProperty(this, '_events', { configurable: true, writable: true, value: {} });\n  }\n\n  /**\n   * Adds an event listener\n   */\n  on(type, listener) {\n    this._events[type] = getEventListeners(this, type).concat([listener]);\n    return this;\n  }\n\n  /**\n   * Adds an event listener to be triggered only once\n   */\n  once(type, listener) {\n    this.on(type, function wrap() {\n      this.off(type, wrap);\n      listener.apply(this, arguments);\n    });\n    return this;\n  }\n\n  /**\n   * Removes a previously added event listener\n   */\n  off(type, listener) {\n    this._events[type] = getEventListeners(this, type).filter(function(l) {\n      return l !== listener;\n    });\n    return this;\n  }\n\n  /**\n   * Checks if there are any event listeners for this event\n   */\n  hasListeners(type) {\n    return getEventListeners(this, type).length > 0;\n  }\n\n  /**\n   * Dispatches an event calling all listeners with the given args (minus type).\n   */\n  dispatchEvent(type /*[, args]*/) {\n    var args = slice.call(arguments, 1);\n    getEventListeners(this, type).forEach(function(listener) {\n      listener.apply(this, args);\n    }, this);\n    return this;\n  }\n\n  /**\n   * Dispatches an event but stops on the first listener to return false. Returns true if no listeners cancel the\n   * action. Use for \"cancelable\" actions to check if they can be performed.\n   */\n  dispatchCancelableEvent(type /*[, args]*/) {\n    var args = slice.call(arguments, 1);\n    return getEventListeners(this, type).every(function(listener) {\n      return listener.apply(this, args) !== false;\n    }, this);\n  }\n\n  removeAllEvents() {\n    this._events = {};\n  }\n}\n\n\n/**\n * Get the listeners for the given object by the given event type.\n */\nfunction getEventListeners(obj, type) {\n  var listeners = obj._events[type];\n  if (!listeners) {\n    obj._events[type] = listeners = [];\n  }\n  return listeners;\n}\n","import EventDispatcher from './event-dispatcher';\nconst maxString = String.fromCharCode(65535);\nconst localStorage = window.localStorage;\nconst noop = data => data;\n\n\n/**\n * A nice promise-based syntax on indexedDB also providing events when open, closed, and whenever data is changed.\n * Dispatches the change events even when the change did not originate in this browser tab.\n *\n * Versioning is simplified. You provide a string of new indexes for each new version, with the first being the primary\n * key. For primary keys, use a \"++\" prefix to indicate auto-increment, leave it empty if the key isn't part of the\n * object. For indexes, use a \"-\" index to delete a defined index, use \"&\" to indicate a unique index, use \"*\" for a\n * multiEntry index, and use \"[field + anotherField]\" for compound indexes. Examples:\n *\n * // Initial version, should remain the same with updates\n * db.version(1, {\n *   friends: 'fullName, age'\n * });\n *\n * // Next version, we don't add any indexes, but we want to run our own update code to prepopulate the database\n * db.version(2, {}, function(oldVersion, transaction) {\n *   // prepopulate with some initial data\n *   transaction.objectStore('friends').put({ fullName: 'Tom' });\n * });\n *\n * // Remove the age index and add one for birthdate, add another object store with an auto-incrementing primary key\n * // that isn't part of the object, and a multiEntry index on the labels array.\n * db.version(3, {\n *   friends: 'birthdate, -age, [lastName + firstName]',\n *   events: '++, date, *labels'\n * });\n *\n *\n * After the database is opened, a property will be added to the database instance for each object store in the\n * database. This is how you will work with the data in the database. For e.g.\n *\n * db.version(1, { foo: 'id' });\n *\n * // Will be triggered once for any add, put, or delete done in any browser tab. The object will be null when it was\n * // deleted, so use the key when object is null.\n * db.on('change', (object, key) => {\n *   console.log('Object with key', key, 'was', object === null ? 'deleted' : 'saved');\n * });\n *\n * db.open().then(() => {\n *   db.foo.put({ id: 'bar' }).then(() => {\n *     console.log('An object was saved to the database.');\n *   });\n * }, err => {\n *   console.warn('There was an error opening the database:', err);\n * });\n */\nexport default class Browserbase extends EventDispatcher {\n\n  /**\n   * Deletes a database by name.\n   * @return {Promise}\n   */\n  static deleteDatabase(name) {\n    return requestToPromise(window.indexedDB.deleteDatabase(name));\n  }\n\n  /**\n   * Creates a new indexeddb database with the given name.\n   */\n  constructor(name, parentDb) {\n    super();\n    this.name = name;\n    this.db = null;\n    this.parentDb = parentDb;\n    this._dispatchRemote = false;\n    this._current = null;\n    this._versionMap = {};\n    this._versionHandlers = {};\n    this._onStorage = null;\n  }\n\n  /**\n   * Defines a version for the database. Additional versions may be added, but existing version should not be changed.\n   * @param  {Number} version           The version number\n   * @param  {Object} stores            An object with store name as the key and a comma-delimited string of indexes\n   * @param  {Function} upgradeFunction An optional function that will be called when upgrading, used for data updates\n   * @return {Browserbase}                A reference to itself\n   */\n  version(version, stores, upgradeFunction) {\n    this._versionMap[version] = stores;\n    if (upgradeFunction) {\n      this._versionHandlers[version] = upgradeFunction;\n    }\n    return this;\n  }\n\n  /**\n   * Returns a list of the defined versions.\n   */\n  getVersions() {\n    return Object.keys(this._versionMap).map(key => {\n      return { version: parseInt(key), stores: this._versionMap[key], upgradeFunction: this._versionHandlers[key] };\n    });\n  }\n\n  /**\n   * Whether this database is open or closed.\n   * @return {Boolean}\n   */\n  isOpen() {\n    return Boolean(this.db);\n  }\n\n  /**\n   * Open a database, call this after defining versions.\n   * @return {Promise}\n   */\n  open() {\n    if (this._opening) {\n      return this._opening;\n    }\n\n    if (!Object.keys(this._versionMap).length) {\n      return Promise.reject(new Error('Must declare at least a version 1 schema for Browserbase'));\n    }\n\n    let version = Object.keys(this._versionMap).map(key => parseInt(key)).sort((a, b) => a - b).pop();\n    let upgradedFrom = null;\n\n    return this._opening = new Promise((resolve, reject) => {\n      let request = window.indexedDB.open(this.name, version);\n      request.onsuccess = successHandler(resolve);\n      request.onerror = errorHandler(reject, this);\n      request.onupgradeneeded = event => {\n        this.db = request.result;\n        this.db.onerror = errorHandler(reject, this);\n        this.db.onabort = errorHandler(() => reject(new Error('Abort')), this);\n        let oldVersion = event.oldVersion > Math.pow(2, 62) ? 0 : event.oldVersion; // Safari 8 fix.\n        upgradedFrom = oldVersion;\n        upgrade(oldVersion, request.transaction, this.db, this._versionMap, this._versionHandlers, this);\n      };\n    }).then(db => {\n      this.db = db;\n      onOpen(this);\n      if (upgradedFrom === 0) this.dispatchEvent('create');\n      else if (upgradedFrom) this.dispatchEvent('upgrade', upgradedFrom);\n      this.dispatchEvent('open');\n    });\n  }\n\n  /**\n   * Closes the database.\n   */\n  close() {\n    if (!this.db) return;\n    this.db.close();\n    this._opening = undefined;\n    onClose(this);\n  }\n\n  /**\n   * Deletes this database.\n   */\n  deleteDatabase() {\n    this.close();\n    return Browserbase.deleteDatabase(this.name);\n  }\n\n  /**\n   * Starts a multi-store transaction. All store methods on the returned database clone will be part of this transaction\n   * until the next tick or until calling db.commit().\n   * @param  {Array} storeNames  Array of all the store names which will be used within this transaction\n   * @param  {String} mode       The mode, defaults to readwrite unlike the indexedDB API\n   * @return {BrowserDB}         A temporary copy of BrowserDB to be used for this transaction only\n   */\n  start(storeNames, mode = 'readwrite') {\n    if (!storeNames) storeNames = this.db.objectStoreNames;\n    if (this._current) throw new Error('Cannot start a new transaction on an existing transaction browserbase');\n\n    const db = new this.constructor(this.name, this);\n    db.db = this.db;\n    Object.keys(this).forEach(key => {\n      const store = this[key];\n      if (!(store instanceof ObjectStore)) return;\n      db[key] = new ObjectStore(db, store.name, store.keyPath);\n      db[key].store = store.store;\n      db[key].revive = store.revive;\n    });\n\n    try {\n      const trans = db._current = storeNames instanceof IDBTransaction\n        ? storeNames\n        : this.db.transaction(safariMultiStoreFix(storeNames), mode);\n      trans.promise = requestToPromise(trans, null, db).then(result => {\n        if (db._current === trans) db._current = null;\n        return result;\n      }, err => {\n        if (db._current === trans) db._current = null;\n        this.dispatchEvent('error', err);\n        return Promise.reject(err);\n      });\n    } catch (err) {\n      Promise.resolve().then(() => {\n        this.dispatchEvent('error', err);\n      });\n      throw err;\n    }\n\n    return db;\n  }\n\n  /**\n   * Finishes a started transaction so that other transactions may be run. This is not needed for a transaction to run,\n   * but it allows other transactions to be run in this thread. It ought to be called to avoid conflicts with other\n   * code elsewhere.\n   * @return {Promise} The same promise returned by start() which will resolve once the transaction is done.\n   */\n  commit(options) {\n    if (!this._current) throw new Error('There is no current transaction to commit.');\n    const promise = this._current.promise;\n    if (options && options.remoteChange) {\n      this._dispatchRemote = true;\n      promise.then(() => this._dispatchRemote = false);\n    }\n    this._current = null;\n    return promise;\n  }\n\n  /**\n   * Dispatches a change event when an object is being added, saved, or deleted. When deleted, the object will be null.\n   * @param {ObjectStore} store  The object store this object is stored in\n   * @param {Object}      obj    The object being modified or null if the object is deleted\n   * @param {mixed}       key    The key of the object being changed or deleted\n   * @param {String}      from   The source of this event, whether it was from the 'local' window or a 'remote' window\n   */\n  dispatchChange(store, obj, key, from = 'local', dispatchRemote = false) {\n    const declaredFrom = this._dispatchRemote || dispatchRemote ? 'remote' : from;\n    this[store.name].dispatchEvent('change', obj, key, declaredFrom);\n    this.dispatchEvent('change', store.name, obj, key, declaredFrom);\n\n    if (this.parentDb) {\n      this.parentDb.dispatchChange(store, obj, key, from, this._dispatchRemote);\n    } else if (from === 'local') {\n      let itemKey = `browserbase/${this.name}/${store.name}`;\n      // Stringify the key since it could be a string, number, or even an array\n      localStorage.setItem(itemKey, JSON.stringify(key));\n      localStorage.removeItem(itemKey);\n    }\n  }\n\n  /**\n   * Dispatch an error event.\n   */\n  dispatchError(err) {\n    this.dispatchEvent('error', err);\n    if (this.parentDb) {\n      this.dispatchEvent('error', err);\n    }\n  }\n\n  /**\n   * Creates or updates a store with the given indexesString. If null will delete the store.\n   * @param  {String} storeName     The store name\n   * @param  {String} indexesString The string definition of the indexes to add to the store\n   * @return {Promise}           Resolves with an array which is the return result of each iteration\n   */\n  upgradeStore(storeName, indexesString) {\n    if (!this._current) return this.start().upgradeStore(storeName, indexesString);\n    upgradeStore(this.db, this._current, storeName, indexesString);\n  }\n\n}\n\n\n/**\n * An abstraction on object stores, allowing to more easily work with them without needing to always explicitly create a\n * transaction first. Also helps with ranges and indexes and promises.\n */\nclass ObjectStore extends EventDispatcher {\n\n  constructor(db, name, keyPath) {\n    super();\n    this.db = db;\n    this.name = name;\n    this.keyPath = keyPath;\n    this.store = noop;\n    this.revive = noop;\n  }\n\n  _transStore(mode) {\n    try {\n      let trans = this.db._current || this.db.db.transaction(this.name, mode);\n      return trans.objectStore(this.name);\n    } catch (err) {\n      Promise.resolve().then(() => {\n        this.db.dispatchEvent('error', err);\n      });\n      throw err;\n    }\n  }\n\n  /**\n   * Dispatches a change event.\n   */\n  dispatchChange(obj, key) {\n    this.db.dispatchChange(this, obj, key);\n  }\n\n  /**\n   * Dispatch an error event.\n   */\n  dispatchError(err) {\n    this.db.dispatchError(err);\n  }\n\n  /**\n   * Get an object from the store by its primary key\n   * @param  {mixed} id The key of the object being retreived\n   * @return {Promise}  Resolves with the object being retreived\n   */\n  get(key) {\n    return requestToPromise(this._transStore('readonly').get(key), null, this).then(this.revive);\n  }\n\n  /**\n   * Get all objects in this object store. To get only a range, use where()\n   * @return {Promise} Resolves with an array of objects\n   */\n  getAll() {\n    return requestToPromise(this._transStore('readonly').getAll(), null, this)\n      .then(results => results.map(this.revive));\n  }\n\n  /**\n   * Gets the count of all objects in this store\n   * @return {Promise} Resolves with a number\n   */\n  count() {\n    return requestToPromise(this._transStore('readonly').count(), null, this);\n  }\n\n  /**\n   * Adds an object to the store. If an object with the given key already exists, it will not overwrite it.\n   * @param {Object} obj The object you want to add to the store\n   * @param {mixed} key Optional, the key of the object when it is not part of the object fields\n   * @return {Promise}\n   */\n  add(obj, key) {\n    let store = this._transStore('readwrite');\n    return requestToPromise(store.add(this.store(obj), key), store.transaction, this).then(key => {\n      this.dispatchChange(obj, key);\n      return key;\n    });\n  }\n\n  /**\n   * Adds an array of objects to the store in once transaction. You can also call startTransaction and use add().\n   * @param {Array} array The array of objects you want to add to the store\n   * @return {Promise}\n   */\n  addAll(array) {\n    let store = this._transStore('readwrite');\n    return Promise.all(array.map(obj => {\n      return requestToPromise(store.add(this.store(obj)), store.transaction, this).then(key => {\n        this.dispatchChange(obj, key);\n      });\n    }));\n  }\n\n  /**\n   * Adds an array of objects to the store in once transaction. You can also call startTransaction and use add(). Alias\n   * of addAll().\n   * @param {Array} array The array of objects you want to add to the store\n   * @return {Promise}\n   */\n  bulkAdd(array) {\n    return this.addAll(array);\n  }\n\n  /**\n   * Saves an object to the store. If an object with the given key already exists, it will overwrite it.\n   * @param {Object} obj The object you want to add to the store\n   * @param {mixed} key Optional, the key of the object when it is not part of the object fields\n   * @return {Promise}\n   */\n  put(obj, key) {\n    let store = this._transStore('readwrite');\n    return requestToPromise(store.put(this.store(obj), key), store.transaction, this).then(key => {\n      this.dispatchChange(obj, key);\n      return key;\n    });\n  }\n\n  /**\n   * Saves an array of objects to the store in once transaction. You can also call startTransaction and use put().\n   * @param {Array} array The array of objects you want to save to the store\n   * @return {Promise}\n   */\n  putAll(array) {\n    let store = this._transStore('readwrite');\n    return Promise.all(array.map(obj => {\n      return requestToPromise(store.put(this.store(obj)), store.transaction, this).then(key => {\n        this.dispatchChange(obj, key);\n      });\n    }));\n  }\n\n  /**\n   * Saves an array of objects to the store in once transaction. You can also call startTransaction and use put(). Alias\n   * of putAll().\n   * @param {Array} array The array of objects you want to save to the store\n   * @return {Promise}\n   */\n  bulkPut(array) {\n    return this.putAll(array);\n  }\n\n  /**\n   * Deletes an object from the store.\n   * @param {mixed} key The key of the object to delete.\n   * @return {Promise}\n   */\n  delete(key) {\n    let store = this._transStore('readwrite');\n    return requestToPromise(store.delete(key), store.transaction, this).then(() => {\n      this.dispatchChange(null, key);\n    });\n  }\n\n  /**\n   * Deletes all objects from a store.\n   * @return {Promise}\n   */\n  deleteAll() {\n    return this.where().deleteAll();\n  }\n\n  /**\n   * Use to get a subset of items from the store by id or index. Returns a Where object to allow setting the range and\n   * limit.\n   * @param  {String} index The key or index that will be used to retreive the range of objects\n   * @return {Where}        A Where instance associated with this object store\n   */\n  where(index = '') {\n    index = index.replace(/\\s/g, '');\n    return new Where(this, index === this.keyPath ? '' : index);\n  }\n}\n\n\n/**\n * Helps with a ranged getAll or openCursor by helping to create the range and providing a nicer API with returning a\n * promise or iterating through with a callback.\n */\nclass Where {\n  constructor(store, index) {\n    this.store = store;\n    this.index = index;\n    this._upper = undefined;\n    this._lower = undefined;\n    this._upperOpen = false;\n    this._lowerOpen = false;\n    this._value = undefined;\n    this._limit = undefined;\n    this._direction = 'next';\n  }\n\n  /**\n   * Dispatches a change event.\n   */\n  dispatchChange(obj, key) {\n    this.store.dispatchChange(obj, key);\n  }\n\n  /**\n   * Dispatch an error event.\n   */\n  dispatchError(err) {\n    this.store.dispatchError(err);\n  }\n\n  /**\n   * Set greater than the value provided.\n   * @param  {mixed} value The lower bound\n   * @return {Where}       Reference to this\n   */\n  startsAfter(value) {\n    this._lower = value;\n    this._lowerOpen = true;\n    return this;\n  }\n\n  /**\n   * Set greater than or equal to the value provided.\n   * @param  {mixed} value The lower bound\n   * @return {Where}       Reference to this\n   */\n  startsAt(value) {\n    this._lower = value;\n    this._lowerOpen = false;\n    return this;\n  }\n\n  /**\n   * Set less than the value provided.\n   * @param  {mixed} value The upper bound\n   * @return {Where}       Reference to this\n   */\n  endsBefore(value) {\n    this._upper = value;\n    this._upperOpen = true;\n    return this;\n  }\n\n  /**\n   * Set less than or equal to the value provided.\n   * @param  {mixed} value The upper bound\n   * @return {Where}       Reference to this\n   */\n  endsAt(value) {\n    this._upper = value;\n    this._upperOpen = false;\n    return this;\n  }\n\n  /**\n   * Set the exact match, no range.\n   * @param  {mixed} value The value that needs matching on\n   * @return {Where}       Reference to this\n   */\n  equals(value) {\n    this._value = value;\n    return this;\n  }\n\n  /**\n   * Sets the upper and lower bounds to match any string starting with this prefix.\n   * @param  {String} prefix The string prefix\n   * @return {Where}         Reference to this\n   */\n  startsWith(prefix) {\n    return this.startsAt(prefix).endsAt(Array.isArray(prefix) ? prefix.concat([[]]) : prefix + maxString);\n  }\n\n  /**\n   * Limit the return results to the given count.\n   * @param  {Number} count The max number of objects to return\n   * @return {Where}        Reference to this\n   */\n  limit(count) {\n    this._limit = count;\n    return this;\n  }\n\n  /**\n   * Reverses the direction a cursor will get things.\n   * @return {Where} Reference to this\n   */\n  reverse() {\n    this._direction = 'prev';\n    return this;\n  }\n\n  /**\n   * Converts this Where to its IDBKeyRange equivalent.\n   * @return {IDBKeyRange} The range this Where represents\n   */\n  toRange() {\n    if (this._upper !== undefined && this._lower !== undefined) {\n      return IDBKeyRange.bound(this._lower, this._upper, this._lowerOpen, this._upperOpen);\n    } else if (this._upper !== undefined) {\n      return IDBKeyRange.upperBound(this._upper, this._upperOpen);\n    } else if (this._lower !== undefined) {\n      return IDBKeyRange.lowerBound(this._lower, this._lowerOpen);\n    } else if (this._value !== undefined) {\n      return IDBKeyRange.only(this._value);\n    }\n  }\n\n  /**\n   * Get all the objects matching the range limited by the limit.\n   * @return {Promise} Resolves with an array of objects\n   */\n  getAll() {\n    let range = this.toRange();\n    // Handle reverse with cursor\n    if (this._direction === 'prev') {\n      let results = [];\n      if (this._limit <= 0) return Promise.resolve(results);\n      return this.forEach(obj => results.push(this.store.revive(obj))).then(() => results);\n    }\n\n    let store = this.store._transStore('readonly');\n    let source = this.index ? store.index(this.index) : store;\n    return requestToPromise(source.getAll(range, this._limit), null, this)\n      .then(results => results.map(this.store.revive));\n  }\n\n  /**\n   * Get all the keys matching the range limited by the limit.\n   * @return {Promise} Resolves with an array of objects\n   */\n  getAllKeys() {\n    let range = this.toRange();\n    // Handle reverse with cursor\n    if (this._direction === 'prev') {\n      let results = [];\n      if (this._limit <= 0) return Promise.resolve(results);\n      return this.cursor(cursor => results.push(cursor.key), 'readonly', true).then(() => results);\n    }\n\n    let store = this.store._transStore('readonly');\n    let source = this.index ? store.index(this.index) : store;\n    return requestToPromise(source.getAllKeys(range, this._limit), null, this);\n  }\n\n  /**\n   * Gets a single object, the first one matching the criteria\n   * @return {Promise} Resolves with an object or undefined if none was found\n   */\n  get() {\n    return this.limit(1).getAll().then(result => this.store.revive(result[0]));\n  }\n\n  /**\n   * Gets a single key, the first one matching the criteria\n   * @return {Promise} Resolves with an object or undefined if none was found\n   */\n  getKey() {\n    // Allow reverse() to be used by going through the getAllKeys method\n    return this.limit(1).getAllKeys().then(result => result[0]);\n  }\n\n  /**\n   * Gets the count of the objects matching the criteria\n   * @return {Promise} Resolves with a number\n   */\n  count() {\n    let range = this.toRange();\n    let store = this.store._transStore('readonly');\n    let source = this.index ? store.index(this.index) : store;\n    return requestToPromise(source.count(range), null, this);\n  }\n\n  /**\n   * Deletes all the objects within this range.\n   * @return {Promise} Resolves without result when finished\n   */\n  deleteAll() {\n    // Uses a cursor to delete so that each item can get a change event dispatched for it\n    return this.map((object, cursor, trans) => {\n      let key = cursor.primaryKey;\n      return requestToPromise(cursor.delete(), trans, this).then(() => {\n        this.dispatchChange(null, key);\n      });\n    }, 'readwrite').then(promises => Promise.all(promises)).then(() => {});\n  }\n\n  /**\n   * Uses a cursor to efficiently iterate over the objects matching the range calling the iterator for each one.\n   * @param  {Function} iterator A function which will be called for each object with the (object, cursor) signature\n   * @return {Promise}           Resolves without result when the cursor has finished\n   */\n  cursor(iterator, mode = 'readonly', keyCursor = false) {\n    return new Promise((resolve, reject) => {\n      let range = this.toRange();\n      let store = this.store._transStore(mode);\n      let source = this.index ? store.index(this.index) : store;\n      let method = keyCursor ? 'openKeyCursor' : 'openCursor'\n      let request = source[method](range, this._direction);\n      let count = 0;\n      request.onsuccess = event => {\n        var cursor = event.target.result;\n        if (cursor) {\n          let result = iterator(cursor, store.transaction);\n          if (this._limit !== undefined && ++count >= this._limit) result = false;\n          if (result !== false) cursor.continue();\n          else resolve();\n        } else {\n          resolve();\n        }\n      };\n      request.onerror = errorHandler(reject, this);\n    });\n  }\n\n  /**\n   * Updates objects using a cursor to update many objects at once matching the range.\n   * @param  {Function} iterator A function which will be called for each object and which should return the new value\n   * for the object, undefined if no changes should be made, or null if the object should be deleted.\n   * @return {Promise}           Resolves without result when finished\n   */\n  update(iterator) {\n    const { store, revive } = this.store;\n    return this.map((object, cursor, trans) => {\n      let key = cursor.primaryKey;\n      let newValue = iterator(object, cursor);\n      if (newValue === null) {\n        return requestToPromise(cursor.delete(), trans, this).then(() => {\n          this.dispatchChange(null, key);\n        });\n      } else if (newValue !== undefined) {\n        return requestToPromise(cursor.update(this.store.store(newValue)), trans, this).then(() => {\n          this.dispatchChange(newValue, key);\n        });\n      } else {\n        return undefined;\n      }\n    }, 'readwrite').then(promises => Promise.all(promises)).then(() => {});\n  }\n\n  /**\n   * Uses a cursor to efficiently iterate over the objects matching the range calling the iterator for each one.\n   * @param  {Function} iterator A function which will be called for each object with the (object, cursor) signature\n   * @return {Promise}           Resolves without result when the cursor has finished\n   */\n  forEach(iterator, mode = 'readonly') {\n    return this.cursor((cursor, trans) => {\n      iterator(this.store.revive(cursor.value), cursor, trans);\n    }, mode);\n  }\n\n  /**\n   * Uses a cursor to efficiently iterate over the objects matching the range calling the iterator for each one and\n   * returning the results of the iterator in an array.\n   * @param  {Function} iterator A function which will be called for each object with the (object, cursor) signature\n   * @return {Promise}           Resolves with an array which is the return result of each iteration\n   */\n  map(iterator, mode = 'readonly') {\n    let results = [];\n    return this.forEach((object, cursor, trans) => {\n      results.push(iterator(object, cursor, trans));\n    }, mode).then(() => results);\n  }\n}\n\n\n\nfunction requestToPromise(request, transaction, errorDispatcher) {\n  return new Promise((resolve, reject) => {\n    if (transaction) {\n      if (!transaction.promise) transaction.promise = requestToPromise(transaction, null, errorDispatcher);\n      transaction.promise = transaction.promise.then(() => resolve(request.result), err => {\n        let requestError;\n        try { requestError = request.error } catch(e) {}\n        reject(requestError || err);\n        return Promise.reject(err);\n      });\n    } else if (request.onsuccess === null) {\n      request.onsuccess = successHandler(resolve);\n    }\n    if (request.oncomplete === null) request.oncomplete = successHandler(resolve);\n    if (request.onerror === null) request.onerror = errorHandler(reject, errorDispatcher);\n    if (request.onabort === null) request.onabort = () => reject(new Error('Abort'));\n  });\n}\n\nfunction successHandler(resolve) {\n  return event => resolve(event.target.result);\n}\n\nfunction errorHandler(reject, errorDispatcher) {\n  return event => {\n    reject(event.target.error);\n    errorDispatcher && errorDispatcher.dispatchError(event.target.error);\n  };\n}\n\nfunction safariMultiStoreFix(storeNames) {\n  return storeNames.length === 1 ? storeNames[0] : storeNames;\n}\n\n\nfunction upgrade(oldVersion, transaction, db, versionMap, versionHandlers, browserbase) {\n  let versions;\n  // Optimization for creating a new database. A version 0 may be used as the \"latest\" version to create a database.\n  if (oldVersion === 0 && versionMap[0]) {\n    versions = [ 0 ];\n  } else {\n    versions = Object.keys(versionMap)\n      .map(key => parseInt(key))\n      .filter(version => version > oldVersion)\n      .sort((a, b) => a - b);\n  }\n\n  versions.forEach(version => {\n    const stores = versionMap[version];\n    Object.keys(stores).forEach(name => {\n      const indexesString = stores[name];\n      upgradeStore(db, transaction, name, indexesString);\n    });\n\n    const handler = versionHandlers[version];\n    if (handler) {\n      // Ensure browserbase has the current object stores for working with in the handler\n      addStores(browserbase, db, transaction);\n      handler(oldVersion, transaction);\n    }\n  });\n}\n\n\nfunction upgradeStore(db, transaction, storeName, indexesString) {\n  const indexes = indexesString && indexesString.split(/\\s*,\\s*/);\n  let store;\n\n  if (indexesString === null) {\n    db.deleteObjectStore(storeName);\n    return;\n  }\n\n  if (db.objectStoreNames.contains(storeName)) {\n    store = transaction.objectStore(storeName);\n  } else {\n    store = db.createObjectStore(storeName, getStoreOptions(indexes.shift()));\n  }\n\n  indexes.forEach(name => {\n    if (!name) return;\n    if (name[0] === '-') return store.deleteIndex(name.replace(/^-[&*]?/, ''));\n\n    let options = {};\n\n    name = name.replace(/\\s/g, '');\n    if (name[0] === '&') {\n      name = name.slice(1);\n      options.unique = true;\n    } else if (name[0] === '*') {\n      name = name.slice(1);\n      options.multiEntry = true;\n    }\n    let keyPath = name[0] === '[' ? name.replace(/^\\[|\\]$/g, '').split(/\\+/) : name;\n    store.createIndex(name, keyPath, options);\n  });\n}\n\n\nfunction onOpen(browserbase) {\n  const db = browserbase.db;\n\n  db.onversionchange = event => {\n    if (browserbase.dispatchCancelableEvent('versionchange')) {\n      if (event.newVersion > 0) {\n        console.warn(`Another connection wants to upgrade database '${browserbase.name}'. Closing db now to resume the upgrade.`);\n      } else {\n        console.warn(`Another connection wants to delete database '${browserbase.name}'. Closing db now to resume the delete request.`);\n      }\n      browserbase.close();\n    }\n  };\n  db.onblocked = event => {\n    if (browserbase.dispatchCancelableEvent('blocked')) {\n      if (!event.newVersion || event.newVersion < event.oldVersion) {\n        console.warn(`Browserbase.delete('${browserbase.name}') was blocked`);\n      } else {\n        console.warn(`Upgrade '${browserbase.name}' blocked by other connection holding version ${event.oldVersion}`);\n      }\n    }\n  };\n  db.onclose = () => onClose(browserbase);\n  db.onerror = event => browserbase.dispatchEvent('error', event.target.error);\n  const prefix = `browserbase/${browserbase.name}/`;\n  browserbase._onStorage = event => {\n    if (event.storageArea !== localStorage) return;\n    if (event.newValue === null || event.newValue === '') return;\n    if (event.key.slice(0, prefix.length) !== prefix) return;\n    try {\n      const storeName = event.key.replace(prefix, '');\n      const key = JSON.parse(event.newValue);\n      const store = browserbase[storeName];\n      if (store) {\n        if (browserbase.hasListeners('change') || store.hasListeners('change')) {\n          store.get(key).then((object = null) => {\n            browserbase.dispatchChange(store, object, key, 'remote');\n          });\n        }\n      } else {\n        console.warn(`A change event came from another tab for store \"${storeName}\", but no such store exists.`);\n      }\n    } catch (err) {\n      console.warn('Error parsing object change from browserbase:', err);\n    }\n  };\n\n  window.addEventListener('storage', browserbase._onStorage);\n\n  // Store keyPath's for each store\n  addStores(browserbase, db, db.transaction(safariMultiStoreFix(db.objectStoreNames), 'readonly'));\n}\n\n\nfunction addStores(browserbase, db, transaction) {\n  const names = db.objectStoreNames;\n  for (let i = 0; i < names.length; i++) {\n    const name = names[i];\n    browserbase[name] = new ObjectStore(browserbase, name, transaction.objectStore(name).keyPath);\n  }\n}\n\nfunction onClose(browserbase) {\n  window.removeEventListener('storage', browserbase._onStorage);\n  browserbase.db = null;\n  browserbase.dispatchEvent('close');\n}\n\nfunction getStoreOptions(keyString) {\n  let keyPath = keyString.replace(/\\s/g, '');\n  let storeOptions = {};\n  if (keyPath.slice(0, 2) === '++') {\n    keyPath = keyPath.replace('++', '');\n    storeOptions.autoIncrement = true;\n  } else if (keyPath[0] === '[') {\n    keyPath = keyPath.replace(/^\\[|\\]$/g, '').split(/\\+/);\n  }\n  if (keyPath) storeOptions.keyPath = keyPath;\n  return storeOptions;\n}\n"],"names":["const","super","version","this","let"],"mappings":"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"}